<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timelapse Camera</title>

<style>
body {
    margin:0;
    background:black;
    color:white;
    font-family:system-ui;
    overflow:hidden;
}

#camera-container {
    position:relative;
    width:100vw;
    height:100vh;
    background:black;
}

video {
    position:absolute;
    width:100%;
    height:100%;
    object-fit:cover;
}

#overlay {
    position:absolute;
    width:100%;
    height:100%;
    object-fit:contain;
    opacity:0.5;
    pointer-events:none;
    transform-origin:center;
}

#controls {
    position:absolute;
    bottom:0;
    width:100%;
    background:rgba(0,0,0,0.6);
    padding:12px;
    box-sizing:border-box;
}

.control-row {
    display:flex;
    align-items:center;
    gap:10px;
    margin:6px 0;
}

input[type=range] {
    flex:1;
}

#buttons {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:10px;
}

#capture {
    width:70px;
    height:70px;
    border-radius:50%;
    border:6px solid white;
    background:transparent;
}

#capture:active {
    background:white;
}

#upload {
    color:white;
}

canvas {
    display:none;
}
</style>
</head>

<body>

<div id="camera-container">

    <video id="video" autoplay playsinline></video>

    <img id="overlay">

    <div id="controls">

        <div class="control-row">
            <label>Opacity</label>
            <input id="opacity" type="range" min="0" max="100" value="50">
        </div>

        <div class="control-row">
            <label>Scale</label>
            <input id="scale" type="range" min="50" max="200" value="100">
        </div>

        <div id="buttons">
            <input type="file" id="upload" accept="image/*">

            <button id="capture"></button>
        </div>

    </div>

</div>

<canvas id="canvas"></canvas>

<script>

const video = document.getElementById("video")
const overlay = document.getElementById("overlay")
const opacitySlider = document.getElementById("opacity")
const scaleSlider = document.getElementById("scale")
const uploadInput = document.getElementById("upload")
const captureButton = document.getElementById("capture")
const canvas = document.getElementById("canvas")

let stream = null

async function startCamera() {

    try {

        stream = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: { ideal: "environment" }
            }
        })

        video.srcObject = stream

    } catch (err) {

        alert("Camera access required")

    }
}

startCamera()


uploadInput.addEventListener("change", (e)=>{

    const file = e.target.files[0]
    if(!file) return

    const reader = new FileReader()

    reader.onload = function(event){

        overlay.src = event.target.result

    }

    reader.readAsDataURL(file)

})


opacitySlider.addEventListener("input", ()=>{

    const value = opacitySlider.value / 100
    overlay.style.opacity = value

})


scaleSlider.addEventListener("input", ()=>{

    const value = scaleSlider.value / 100
    overlay.style.transform = `scale(${value})`

})


captureButton.addEventListener("click", ()=>{

    const width = video.videoWidth
    const height = video.videoHeight

    canvas.width = width
    canvas.height = height

    const ctx = canvas.getContext("2d")

    ctx.drawImage(video,0,0,width,height)

    canvas.toBlob((blob)=>{

        const url = URL.createObjectURL(blob)

        const a = document.createElement("a")

        const now = new Date()

        const filename =
        `timelapse_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}_${now.getHours()}${now.getMinutes()}${now.getSeconds()}.jpg`

        a.href = url
        a.download = filename

        a.click()

    },"image/jpeg",0.95)

})

</script>

</body>
</html>
